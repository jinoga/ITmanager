<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Knowledge Base - IT Service Desk</title>
    <style>
        body {
            font-family: sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f0f2f5;
        }

        h1 {
            color: #9c27b0;
        }

        .card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .kb-item {
            border-bottom: 1px solid #eee;
            padding: 15px 0;
        }

        .kb-item:last-child {
            border-bottom: none;
        }

        .kb-title {
            font-size: 18px;
            font-weight: bold;
            color: #1a73e8;
            cursor: pointer;
        }

        .kb-content {
            display: none;
            margin-top: 10px;
            color: #555;
            line-height: 1.6;
            background: #f9f9f9;
            padding: 10px;
            border-radius: 4px;
        }

        input,
        textarea,
        select {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }

        .btn {
            padding: 10px 20px;
            background-color: #9c27b0;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .nav {
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
        }

        .nav a {
            text-decoration: none;
            color: #5f6368;
            font-weight: bold;
        }

        .nav a.active {
            color: #9c27b0;
            border-bottom: 2px solid #9c27b0;
        }
    </style>
</head>

<body>

    <div class="nav">
        <a href="/">üè† ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°</a>
        <a href="/admin.html">üîß Admin Console</a>
        <a href="/assets.html">üíª ‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô (Assets)</a>
        <a href="/inventory.html">üì¶ ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏™‡∏¥‡πâ‡∏ô‡πÄ‡∏õ‡∏•‡∏∑‡∏≠‡∏á</a>
        <a href="/kb.html" class="active">üìö ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠ (KB)</a>
        <a href="/pm.html">üìÖ ‡πÅ‡∏ú‡∏ô‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤ (PM)</a>
    </div>

    <h1>üìö ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô (Knowledge Base)</h1>

    <!-- Add Form (Visible only to Admin) -->
    <div class="card" id="adminArea" style="display: none;">
        <h2>üìù ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡πÉ‡∏´‡∏°‡πà</h2>
        <form id="addKbForm">
            <input type="text" id="title" placeholder="‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ (‡πÄ‡∏ä‡πà‡∏ô ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠ Wi-Fi)" required>
            <select id="category">
                <option value="General">‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</option>
                <option value="Network">‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï</option>
                <option value="Printer">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå</option>
            </select>
            <textarea id="content" rows="5" placeholder="‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤ / ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç..." required></textarea>
            <button type="submit" class="btn">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠</button>
        </form>
    </div>

    <div class="card">
        <h2>‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
        <div id="kbList"></div>
    </div>

    <script>
        const API_URL = 'http://localhost:3001/api/kb';
        const isAdmin = localStorage.getItem('admin_logged_in');

        if (isAdmin) {
            document.getElementById('adminArea').style.display = 'block';
        }

        window.onload = loadKb;

        async function loadKb() {
            const res = await fetch(API_URL);
            const json = await res.json();
            const list = document.getElementById('kbList');
            list.innerHTML = '';

            if (json.data.length === 0) list.innerHTML = '<p style="color:#888;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°</p>';

            json.data.forEach(item => {
                const div = document.createElement('div');
                div.className = 'kb-item';
                div.innerHTML = `
                    <div class="kb-title" onclick="toggle(${item.id})">üìñ ${item.title} <span style="font-size:12px; color:#888; margin-left:10px;">#${item.category}</span></div>
                    <div class="kb-content" id="content-${item.id}">
                        ${item.content.replace(/\n/g, '<br>')}
                    </div>
                `;
                list.appendChild(div);
            });
        }

        function toggle(id) {
            const el = document.getElementById(`content-${id}`);
            el.style.display = el.style.display === 'block' ? 'none' : 'block';
        }

        document.getElementById('addKbForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const payload = {
                title: document.getElementById('title').value,
                category: document.getElementById('category').value,
                content: document.getElementById('content').value
            };
            await fetch(API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            document.getElementById('addKbForm').reset();
            loadKb();
        });
    </script>
</body>

</html>